<div class="dashboard-container container">
  <!-- Loading State -->
  <div *ngIf="loading" class="spinner">
    <mat-spinner></mat-spinner>
  </div>

  <!-- No Household State -->
  <div *ngIf="!loading && !hasHousehold" class="empty-state">
    <mat-icon class="empty-icon">home</mat-icon>
    <h2>No Household Yet</h2>
    <p>Create or join a household to start managing tasks</p>
    <button mat-raised-button color="primary" (click)="navigateToHousehold()">
      Get Started
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && hasHousehold">
    <!-- Header -->
    <div class="dashboard-header">
      <div>
        <h1>Hello, {{ currentUser?.name?.split(' ')[0] }}! ðŸ‘‹</h1>
        <p class="household-name">{{ household?.name }}</p>
      </div>
      <button mat-icon-button (click)="refresh()" matTooltip="Refresh">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <mat-card class="stat-card stat-completed">
        <mat-icon class="stat-icon">check_circle</mat-icon>
        <div class="stat-number">{{ stats?.completedTasks || 0 }}</div>
        <div class="stat-label">Completed</div>
      </mat-card>

      <mat-card class="stat-card stat-open">
        <mat-icon class="stat-icon">pending_actions</mat-icon>
        <div class="stat-number">{{ stats?.openTasks || 0 }}</div>
        <div class="stat-label">Open Tasks</div>
      </mat-card>

      <mat-card class="stat-card stat-members">
        <mat-icon class="stat-icon">people</mat-icon>
        <div class="stat-number">{{ stats?.totalMembers || 0 }}</div>
        <div class="stat-label">Members</div>
      </mat-card>

      <mat-card class="stat-card stat-points">
        <mat-icon class="stat-icon">emoji_events</mat-icon>
        <div class="stat-number">{{ currentUser?.pointsTotal || 0 }}</div>
        <div class="stat-label">Your Points</div>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <div class="section">
      <h2 class="section-title">Quick Actions</h2>
      <div class="actions-grid">
        <button
          mat-raised-button
          color="primary"
          class="action-btn"
          (click)="navigateToAddTask()"
        >
          <mat-icon>add_circle</mat-icon>
          Add Task
        </button>

        <button
          *ngIf="isAdmin"
          mat-raised-button
          class="action-btn auto-assign-btn"
          (click)="onAutoAssign()"
          [disabled]="autoAssigning"
        >
          <mat-spinner *ngIf="autoAssigning" diameter="20" class="spinner-inline"></mat-spinner>
          <mat-icon *ngIf="!autoAssigning">flash_on</mat-icon>
          <span *ngIf="!autoAssigning">Auto-Assign</span>
          <span *ngIf="autoAssigning">Assigning...</span>
        </button>

        <button
          mat-raised-button
          class="action-btn"
          (click)="navigateToTasks()"
        >
          <mat-icon>list</mat-icon>
          View All Tasks
        </button>

        <button
          mat-raised-button
          class="action-btn"
          (click)="navigateToHousehold()"
        >
          <mat-icon>people</mat-icon>
          Household
        </button>
      </div>
    </div>

    <!-- My Tasks Today -->
    <div class="section">
      <h2 class="section-title">My Tasks Today</h2>
      
      <div *ngIf="myTasks.length === 0" class="empty-tasks">
        <mat-icon>check_circle</mat-icon>
        <p>All caught up! ðŸŽ‰</p>
      </div>

      <div *ngIf="myTasks.length > 0" class="tasks-list">
        <mat-card
          *ngFor="let task of myTasks"
          class="task-card"
          (click)="navigateToTaskDetail(task._id)"
        >
          <div class="task-header">
            <h3 class="task-title">{{ task.title }}</h3>
            <span class="badge" [ngClass]="getPriorityClass(task.priority)">
              {{ task.priority }}
            </span>
          </div>
          
          <p *ngIf="task.description" class="task-description">
            {{ task.description }}
          </p>

          <div class="task-footer">
            <div class="task-meta">
              <mat-icon>schedule</mat-icon>
              <span>{{ task.estimatedMinutes }} min</span>
            </div>
            <div class="task-meta">
              <mat-icon>calendar_today</mat-icon>
              <span>{{ task.dueDate | date:'short' }}</span>
            </div>
            <div class="task-meta">
              <mat-icon class="points-icon">emoji_events</mat-icon>
              <span>{{ task.points }} pts</span>
            </div>
          </div>
        </mat-card>
      </div>
    </div>
  </div>
</div>
